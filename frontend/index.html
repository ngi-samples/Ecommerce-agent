<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🛒 AI Shopping Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header class="bg-white shadow p-4 mb-6">
      <h1 class="text-2xl font-bold text-center text-blue-600">
        🛒 DSPy AI Shopping Assistant
      </h1>
    </header>

    <main class="max-w-4xl mx-auto space-y-10 p-4">
      <!-- 🔍 Product Search -->
      <section class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Search Product</h2>
        <div class="flex gap-4">
          <input
            id="searchInput"
            type="text"
            placeholder="e.g. iPhone 14"
            class="w-full border border-gray-300 rounded px-4 py-2"
          />
          <button
            onclick="searchProduct()"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
          >
            Search
          </button>
        </div>
        <div id="searchResults" class="mt-4 text-gray-700"></div>
      </section>

      <!-- ⚔️ Product Comparison -->
      <section class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">
          Compare Products
        </h2>
        <div class="grid grid-cols-2 gap-4">
          <input
            id="product1"
            type="text"
            placeholder="Product 1"
            class="border border-gray-300 rounded px-4 py-2"
          />
          <input
            id="product2"
            type="text"
            placeholder="Product 2"
            class="border border-gray-300 rounded px-4 py-2"
          />
        </div>
        <button
          onclick="compareProducts()"
          class="mt-4 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
        >
          Compare
        </button>
        <div id="comparisonResult" class="mt-4 text-gray-700"></div>
      </section>

      <!-- 🛒 Cart Management -->
      <section class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Cart Manager</h2>
        <div class="flex flex-wrap gap-4 items-center">
          <select
            id="cartAction"
            class="border border-gray-300 rounded px-4 py-2"
          >
            <option value="add">Add</option>
            <option value="remove">Remove</option>
            <option value="view">View</option>
          </select>
          <input
            id="cartProduct"
            type="text"
            placeholder="Product name (if needed)"
            class="border border-gray-300 rounded px-4 py-2 flex-1"
          />
          <button
            onclick="manageCart()"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
          >
            Submit
          </button>
        </div>
        <div id="cartResult" class="mt-4 text-gray-700"></div>
      </section>
    </main>

    <script>
      const API = "http://127.0.0.1:8000";

      async function searchProduct() {
        const query = document.getElementById("searchInput").value;
        const res = await fetch(`${API}/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query }),
        });
        const data = await res.json();
        if (Array.isArray(data.results)) {
          document.getElementById("searchResults").innerText =
            data.results.join(", ");
        } else if (typeof data.results === "string") {
          document.getElementById("searchResults").innerText = data.results;
        } else {
          document.getElementById("searchResults").innerText =
            "No results found";
        }
      }

      async function compareProducts() {
        const product1 = document.getElementById("product1").value;
        const product2 = document.getElementById("product2").value;
        const res = await fetch(`${API}/compare`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ product1, product2 }),
        });
        const data = await res.json();
        document.getElementById("comparisonResult").innerText =
          data.comparison || data.detail;
      }

      async function manageCart() {
        const action = document.getElementById("cartAction").value;
        const product = document.getElementById("cartProduct").value;
        const res = await fetch(`${API}/cart`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, product }),
        });
        const data = await res.json();
        document.getElementById("cartResult").innerText =
          data.cart || data.detail;
      }
    </script>
  </body>
</html>
